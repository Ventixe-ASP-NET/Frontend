@model WebApp.Views.Bookings.BookingModels.BookingChartModel

<div class="chart-card">
    <div class="chart-header">
        <h4>Bookings Overview</h4>
        <select id="chartRangeSelect" class="chart-select">
            <option value="today">Today</option>
            <option value="week" selected>This Week</option>
            <option value="month">This Month</option>
            <option value="all">All Time</option>
        </select>
    </div>
    <canvas id="bookingChart" width="100%" height="350"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    let bookingChart;

    document.addEventListener("DOMContentLoaded", function () {
        let chartLabels = @Html.Raw(Json.Serialize(Model.Labels));
        let chartData = @Html.Raw(Json.Serialize(Model.Data));

        const ctx = document.getElementById('bookingChart').getContext('2d');

        bookingChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: chartLabels,
                datasets: [{
                    label: '', // tar bort bokningslabel
                    data: chartData,
                    fill: true,
                    tension: 0.4,
                    borderColor: '#f0f',
                    backgroundColor: 'rgba(240, 0, 240, 0.1)',
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false } // 🔥 tar bort "Bookings"-legend
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { precision: 0 }
                    }
                }
            }
        });

        document.getElementById("chartRangeSelect").addEventListener("change", async function () {
            const range = this.value;

            try {
                const res = await fetch("https://bookingserviceventixe-fbb7amdzfsh4b4d6.swedencentral-01.azurewebsites.net/api/bookings/stats/overview?range=" + range);
                const updated = await res.json().catch(() => ({ labels: [], data: [] }));

                bookingChart.data.labels = updated.labels;
                bookingChart.data.datasets[0].data = updated.data;
                bookingChart.update();
            } catch (err) {
                console.error("❌ API error:", err);
            }
        });
    });
</script>
